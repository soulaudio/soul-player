version: '3.9'

# Soul Player - Production Docker Compose
# ========================================
# Single container serving both API and Web UI on port 8080
#
# Usage:
#   docker compose up -d
#
# Access:
#   - Web UI: http://localhost:8080
#   - API:    http://localhost:8080/api
#
# For API-only (no web UI), use:
#   docker build -f applications/server/Dockerfile.server-only -t soul-server:api .

services:
  soul-player:
    build:
      context: .
      dockerfile: applications/server/Dockerfile
    container_name: soul-player
    ports:
      - "8080:8080"
    environment:
      # Server configuration
      SOUL_SERVER_HOST: 0.0.0.0
      SOUL_SERVER_PORT: 8080

      # Storage configuration
      SOUL_STORAGE_DATABASE_URL: sqlite:///app/data/soul.db
      SOUL_STORAGE_MUSIC_STORAGE_PATH: /app/data/tracks

      # Auth configuration (CHANGE THIS IN PRODUCTION!)
      SOUL_AUTH_JWT_SECRET: ${JWT_SECRET:-dev-secret-change-in-production}
      SOUL_AUTH_JWT_EXPIRATION_HOURS: 24
      SOUL_AUTH_JWT_REFRESH_EXPIRATION_DAYS: 30

      # Transcoding configuration
      SOUL_TRANSCODING_ENABLED: true
      SOUL_TRANSCODING_WORKERS: 2
      SOUL_TRANSCODING_FFMPEG_PATH: /usr/bin/ffmpeg

      # Logging
      RUST_LOG: soul_server=info,tower_http=info
    volumes:
      # Persist database and music files
      - soul-data:/app/data
      # Mount local music directory (optional)
      # Uncomment and adjust path as needed:
      # - /path/to/your/music:/app/music:ro
    restart: unless-stopped

volumes:
  soul-data:
    driver: local
